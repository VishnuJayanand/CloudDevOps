kind: pipeline
type: docker
name: default

steps:
- name: decrypt - managing secret solution files
  # cp. https://hub.docker.com/r/frapsoft/openssl
  image: frapsoft/openssl
  environment:
    KEY:
      from_secret: key
  commands:
  - openssl enc -d -aes-256-cbc -md sha256 -pass env:KEY -in ./${DRONE_BRANCH}/solution.py.enc -out ./${DRONE_BRANCH}/solution.py


- name: check if main is correct
  image: python:3.8.3
  commands:
  - cd ${DRONE_BRANCH}
  - python solution.py > expected_result.txt
  - python main.py > output.txt
  - diff -q output.txt expected_result.txt

trigger:
  branch:
  - feature*